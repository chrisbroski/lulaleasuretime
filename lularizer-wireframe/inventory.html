<!doctype html>
<title>Lularize Wireframe</title>
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
<link rel="stylesheet" type="text/css" href="main.css">
<style>
#inventory img {width: 90px; }
h3 {
    font-family: steelfish;
    text-transform: capitalize;
}
.selected {
    box-shadow: 2px 2px 8px black;
    position: relative;
    top: -1px; left: -1px;
}
</style>

<article>
<h1><a href="/lularizer-wireframe/">LuLaRizer</a></h1>
<div id="inventory"></div>

<footer>
<p>
<button id="editPhoto" disabled="disabled">edit</button>
<button>delete</button>
</footer>

</article>

<script>
var invObj;

function getEventTarget(e) {
    var targ;
    targ = e.target || e.srcElement;
    if (targ.nodeType === 3) { // defeat Safari bug
        targ = targ.parentNode;
    }
    return targ;
}

function addEvent(el, evType, fn, bubble) {
    bubble = bubble || false;
    if (el.addEventListener) {
        el.addEventListener(evType, fn, bubble);
    } else if (el.attachEvent) {
        el.attachEvent("on" + evType, fn);
    }
}

function touchclick(el, func, bubble) {
    bubble = !!bubble;
    if ('ontouchstart' in window || 'onmsgesturechange' in window) {
        el.addEventListener('touchstart', func, bubble);
    } else {
        addEvent(el, 'click', func, bubble);
    }
}

function oneSelected() {
    var selectedPhotos = document.querySelectorAll('#inventory img'),
        ii,
        len,
        countSelected = 0;

    len = selectedPhotos.length;
    for (ii = 0; ii < len; ii += 1) {
        if (selectedPhotos[ii].className === 'selected') {
            countSelected += 1;
        }
    }

    if (countSelected === 1) {
        return true;
    }
    return false;
}

function selectPhoto(e) {
    var targ = getEventTarget(e),
        editButton = document.getElementById('editPhoto');

    if (targ.nodeName === 'IMG') {
        if (targ.className === 'selected') {
            targ.className = '';
            editButton.disabled = true;
        } else {
            targ.className = 'selected';
            editButton.disabled = false;
        }
    }

    editButton.disabled = !oneSelected();
}

function loadPhotos() {
    var invString = localStorage.inventory,
        invList = document.getElementById('inventory'),
        photo,
        img,
        header;
    if (invString) {
        invObj = JSON.parse(invString);
    } else {
        invObj = {};
    }

    for (style in invObj) {
        if (invObj.hasOwnProperty(style)) {
            header = document.createElement('h3');
            header.textContent = style;
            invList.appendChild(header);
            invObj[style].forEach(function (photo) {
                img = document.createElement('img');
                img.src = photo;
                invList.appendChild(img);
            });
        }
    }
}

function load() {
    loadPhotos();
    var invList = document.getElementById('inventory');
    touchclick(invList, selectPhoto);
}

window.onload = load;
</script>
