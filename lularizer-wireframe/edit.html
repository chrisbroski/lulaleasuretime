<!doctype html>
<title>Lularize Wireframe</title>
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="stylesheet" href="mdl/material.lime-pink.min.css">
<script src="mdl/material.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" type="text/css" href="mdl/mdl-custom.css">
<style>
canvas {
    /*border: 1px solid #333;*/
    background: #fff;
    max-width: 100%;
}
article {padding-bottom: 64px; }
#watermark {width: 100%; font-family: maven; }
p {margin: 0.5em 0; }
footer p {margin: 1em 0; }

#colors > div {
    margin: 0 5px;
    width: 20px; height: 20px;
    display: inline-block;
}
#colors {padding-top: 2px;}
.selectedColor {
    box-shadow: 1px 1px 3px black;
    position: relative;
    top: -1px; left: -1px;
}

#selectStyle {text-transform: capitalize; }

#colorYellow {background-color: #fed141; }
#colorOrange {background-color: #ff9d68; }
#colorPink {background-color: #f97599; }
#colorFuchsia {background-color: #dd7fd3; }
#colorPurple {background-color: #9595d2; }
#colorBlue {background-color: #8bb8e8; }
#colorGreen {background-color: #64ccc9; }
#colorGray {background-color: #888b8d; }
</style>

<div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">

<header class="mdl-layout__header">
<div class="mdl-layout__header-row">
<span class="mdl-layout__title"><a href="/lularizer-wireframe/">LuLaRizer</a></span>
</div>
</header>

<div class="mdl-layout__drawer">
<span class="mdl-layout__title">LuLaRizer</span>
<nav class="mdl-navigation">
<a class="mdl-navigation__link" href="new" onclick="location='new'; return false; ">Add From Camera</a>
<a class="mdl-navigation__link" href="#" onclick="location='collection'; return false; ">Add From Collection</a>
<a class="mdl-navigation__link" href="inventory" onclick="location='inventory'; return false; ">Browse Inventory</a>
<a class="mdl-navigation__link" href="#" onclick="return false; ">Inventory Audit</a>
<a class="mdl-navigation__link" href="#" onclick="return false; ">Upload to Facebook</a>
</nav>
</div>

<main class="mdl-layout__content">
<div class="mdl-card mdl-shadow--4dp">
<div class="mdl-card__media">
<canvas width="450" height="400" id="preview"></canvas>
</div>
<div class="mdl-card__supporting-text">
    <div id="colors">
        <div id="colorYellow"></div>
        <div id="colorOrange"></div>
        <div id="colorPink"></div>
        <div id="colorFuchsia"></div>
        <div id="colorPurple"></div>
        <div id="colorBlue"></div>
        <div id="colorGreen"></div>
    </div>

    <p><label>Style</label> <select id="selectStyle"></select>
        <label>Size</label> <select id="selectSize"></select>
    <p><input id="watermark" value="www.LuLaLeasureTime.com">
</div>
<div class="mdl-card__actions">
    <button onclick="history.back()" class="mdl-button mdl-js-button mdl-shadow--2dp">Cancel</button>
    <button onclick="save()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">Save</button>
</div>
</div>
</main>

</div>

<script>
var colors = {
    'colorYellow': '#fed141',
    'colorOrange': '#ff9d68',
    'colorPink': '#f97599',
    'colorFuchsia': '#dd7fd3',
    'colorPurple': '#9595d2',
    'colorBlue': '#8bb8e8',
    'colorGreen': '#64ccc9',
    'colorGray': '#888b8d'
}, color = '#fed141';

var styleData = {
    'joy': {'price': 60, 'sizes': ['xs', 's', 'm', 'l', 'xl']},
    'tween': {'price': 23},
    'tall_&_curvy': {'price': 25},
    'kids_s/m': {'price': 23},
    'sloan': {'price': 28, 'sizes': ['2', '4', '6', '8', '10', '12', '14']},
    'sarah': {'price': 70, 'sizes': ['xs', 's', 'm', 'l', 'xl']},
    'randy': {'price': 35, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'perfect_t': {'price': 36, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'patrick': {'price': 40, 'sizes': ['m', 'l', 'xl', '2xl', '3xl']},
    'one_size': {'price': 25},
    'nicole': {'price': 48, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'monroe': {'price': 48, 'sizes': ['s', 'l']},
    'maxi': {'price': 42, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'madison': {'price': 48, 'sizes': ['xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'kids_l/xl': {'price': 23},
    'lucy': {'price': 52, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl']},
    'lola': {'price': 48, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl']},
    'lindsay': {'price': 48, 'sizes': ['s', 'm', 'l']},
    'kids_azure': {'price': 25, 'sizes': ['2', '4', '6', '8', '10', '12', '14']},
    'julia': {'price': 45, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'jordan': {'price': 65, 'sizes': ['xs', 's', 'm', 'l', 'xl', '2xl']},
    'jill': {'price': 55, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl']},
    'jade': {'price': 55, 'sizes': ['xs', 's', 'm', 'l', 'xl', '2xl']},
    'irma': {'price': 35, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'gracie': {'price': 28, 'sizes': ['2', '4', '6', '8', '10', '12', '14']},
    'classic_t': {'price': 35, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'cassie': {'price': 35, 'sizes': ['xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'azure': {'price': 35, 'sizes': ['xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'ana': {'price': 60, 'sizes': ['xs', 's', 'm', 'l', 'xl', '2xl', '3xl']},
    'amelia': {'price': 65, 'sizes': ['xxs', 'xs', 's', 'm', 'l', 'xl', '2xl']},
    'carly': {'price': 55, 'sizes': ['xxxs', 'xxs', 'xs', 's', 'm', 'l', 'xl', 'xxl', 'xxxl']}
};

function Q$(name) {
    var reQs, val;
    reQs = new RegExp("[\\?&]" + name + "=([^&#]*)", "i");
    val = reQs.exec(parent.location.search);
    return (val) ? unescape(val[1]) : "";
}

function capitalizeEachWord(str) {
    return str.replace(/\w\S*/g, function (txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
}

function formatStyle(styleType) {
    return styleType.replace(/_/g, ' ');
}

function buildSizeUI() {
    var selSizes = document.getElementById('selectSize'),
        selectedStyle = document.getElementById('selectStyle').value,
        option;

    selSizes.innerHTML = '';
    if (selectedStyle && styleData[selectedStyle].sizes) {
        styleData[selectedStyle].sizes.forEach(function (size) {
            option = document.createElement('option');
            option.value = size;
            option.textContent = size.toUpperCase();
            selSizes.appendChild(option);
        });
        selSizes.selectedIndex = Math.floor(selSizes.options.length / 2);
        selSizes.disabled = false;
    } else {
        selSizes.disabled = true;
    }
}

function buildStyleUI() {
    var selStyle = document.getElementById('selectStyle'),
        iStyle = localStorage.style || 0,
        option;

    for (style in styleData) {
        if (styleData.hasOwnProperty(style)) {
            option = document.createElement('option');
            option.value = style;
            option.textContent = formatStyle(style);
            selStyle.appendChild(option);
        }
    }
    selStyle.selectedIndex = iStyle;

    buildSizeUI();
}

function logo(ctx) {
    // LuLaRoe Logo
    ctx.beginPath();
    ctx.lineWidth = 4.8;
    ctx.strokeStyle = '#fed141';
    ctx.rect(307, 258, 135, 135);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle = '#ff9d68';
    ctx.rect(318, 269, 113, 113);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle = '#f97599';
    ctx.rect(329, 280, 91, 91);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle = '#dd7fd3';
    ctx.rect(340, 291, 69, 69);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle = '#9595d2';
    ctx.rect(351, 302, 47, 47);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle = '#8bb8e8';
    ctx.rect(362, 313, 25, 25);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle = '#64ccc9';
    ctx.rect(372.5, 323.5, 4, 4);
    ctx.stroke();
}

function emboss(img, style, lulalroeColor, size, watermark) {
    var canvas = document.getElementById('preview'),
        ctx = canvas.getContext('2d');

    ctx.lineWidth = 1;
    ctx.strokeStyle = lulalroeColor;
    ctx.fillStyle = lulalroeColor;
    ctx.textAlign = 'center';
    ctx.font = '20px maven';

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, 300, 400);

    // add watermark
    ctx.fillStyle = 'black';
    ctx.fillText(watermark, 151, 391);
    ctx.strokeStyle = lulalroeColor;
    ctx.fillStyle = lulalroeColor;
    ctx.fillText(watermark, 150, 390);

    ctx.fillRect(300, 0, 150, 65);
    ctx.font = '44px steelfish';

    if (size) {
        ctx.fillText(size.toUpperCase(), 375, 130);
        ctx.fillText('$' + styleData[style].price, 375, 200);
    } else {
        ctx.fillText('$' + styleData[style].price, 375, 130);
    }

    ctx.strokeStyle = 'white';
    ctx.fillStyle = 'white';
    ctx.font = '40px steelfish';
    ctx.fillText(formatStyle(style).toUpperCase(), 375, 49);

    logo(ctx);
}

function lularize() {
    var color = localStorage.color,
        lulalroeColor = colors[color],
        style = document.getElementById('selectStyle').options[localStorage.style].value,
        size = document.getElementById('selectSize').value,
        img = new Image();

    img.addEventListener("load", function () {
        emboss(this, style, lulalroeColor, size, document.getElementById('watermark').value);
    }, false);
    img.src = 'album/' + Q$('file'); // Set source path somehow
}

function save() {
    /* After save, go back to camera or album */
    var bitmapData = document.getElementById('preview').toDataURL(),
        invString,
        invObj,
        style = document.getElementById('selectStyle').value;

    invString = localStorage.getItem('inventory');
    if (!invString) {
        invObj = {};
    } else {
        invObj = JSON.parse(invString);
    }

    if (!invObj[style]) {
        invObj[style] = [];
    }
    invObj[style].push(bitmapData);
    localStorage.setItem('inventory', JSON.stringify(invObj));
    history.back();
}

function getEventTarget(e) {
    var targ;
    targ = e.target || e.srcElement;
    if (targ.nodeType === 3) { // defeat Safari bug
        targ = targ.parentNode;
    }
    return targ;
}

function addEvent(el, evType, fn, bubble) {
    bubble = bubble || false;
    if (el.addEventListener) {
        el.addEventListener(evType, fn, bubble);
    } else if (el.attachEvent) {
        el.attachEvent("on" + evType, fn);
    }
}

function touchclick(el, func, bubble) {
    bubble = !!bubble;
    if ('ontouchstart' in window || 'onmsgesturechange' in window) {
        el.addEventListener('touchstart', func, bubble);
    } else {
        addEvent(el, 'click', func, bubble);
    }
}

function isColorButton(el) {
    var colorIds = ['colorYellow', 'colorOrange', 'colorPink', 'colorFuchsia', 'colorPurple', 'colorBlue', 'colorGreen', 'colorGray'];
    if (colorIds.indexOf(el.id) > -1) {
        return true;
    }
    return false;
}

function changeStyle() {
    var iStyle = document.getElementById('selectStyle').selectedIndex;
    localStorage.style = iStyle;
    buildSizeUI();
    lularize();
}

function changeColor(e) {
    var targ = getEventTarget(e);
    if (isColorButton(targ)) {
        document.getElementById('colorYellow').className = '';
        document.getElementById('colorOrange').className = '';
        document.getElementById('colorPink').className = '';
        document.getElementById('colorFuchsia').className = '';
        document.getElementById('colorPurple').className = '';
        document.getElementById('colorBlue').className = '';
        document.getElementById('colorGreen').className = '';

        targ.className = 'selectedColor'
        localStorage.color = targ.id;
        lularize();
    }
}

function init() {
    if (localStorage.color && colors[localStorage.color]) {
        color = localStorage.color;
    } else {
        color = 'colorYellow';
    }

    document.getElementById(color).className = 'selectedColor'

    if (localStorage.style && styleData[localStorage.style]) {
        style = localStorage.style;
    } else {
        localStorage.style = 0;
    }
}

function load() {
    buildStyleUI();
    document.getElementById('selectStyle').onchange = changeStyle;
    document.getElementById('selectSize').onchange = lularize;
    touchclick(document.getElementById('colors'), changeColor);
    document.getElementById('watermark').onchange = lularize;

    init();
    window.setTimeout(lularize, 50);
}

window.onload = load;

</script>
